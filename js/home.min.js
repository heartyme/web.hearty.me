"use strict";var btn_alias="home";function alice_update(e){return $.ajax({url:location.href,type:"POST",dataType:"json",data:e,async:!0})}function user_verify(e){return e&&msg('<i class="far fa-info-circle"></i> '+_h("A-verify-0"),'<i class="fas fa-address-card"></i> '+_h("A-verify-1"),function(){hj_href("account")}),parseInt($("body").attr("data-verified"))>1}function directory_scrolltop(e){let t=$(".directory");return e?(t.stop().scrollTop(0),0):t.scrollTop()}function hj_alice_history_init(){"function"==typeof history.pushState&&(hj_alice_history_push(),window.addEventListener("popstate",function(){let e=$(".goodnight").scrollLeft();$(".goodnight .profile").is(":visible")?(profile_popup(),hj_alice_history_push()):0==$(".alice_inner [data-opinions][data-off]").length?(alice_opinions_toggle(),hj_alice_history_push()):directory_scrolltop()>50?(nav_goodnight(+(0==e)),hj_alice_history_push()):(directory_scrolltop(!0),hj_href("d")),null!=$("nav.menu").data("mmenu")&&$("nav.menu").data("mmenu").close()},!1))}function hj_alice_history_push(){history.pushState(null,document.title,location.href)}function nav_goodnight(e,t){let i=$(".goodnight");i.length>0&&i.get(0).scroll({left:i.width()*(e||0),behavior:t?"instant":"smooth"})}function alice_opinions_toggle(e){let t=$(".alice_inner [data-quote]"),i=$(".alice_inner [data-opinions]"),n=i.find("ul");e||n.is(":hidden")?(i.removeAttr("data-off"),t.attr("data-blur",""),check_OS("Android")?n.fadeIn("fast"):n.slideDown("fast")):n.fadeOut("fast",function(){i.attr("data-off",""),t.removeAttr("data-blur")})}function alice_greeting_read(e){alice_update({greeting_id:e||""}).then(function(t){switch(t.Status){case 0:alice_greeting_read(),msg('<i class="fal fa-comment-exclamation"></i> '+_h("A-no_post"));break;case 1:e=(t=t.Values).greeting_id;let i=$(".goodnight"),n=i.find("article"),a=i.find("[data-opinions] ul");i.find("[data-quote]").attr({title:t.greeting}).find("img").attr({src:"//i0.wp.com/storage.googleapis.com/hearty_photo_greetings/"+t.greeting_image,alt:t.greeting}),n.find("h4").text(t.greeting||""),n.find("h5").text(t.greeting_title||""),n.find("p").text(t.greeting_post||""),a.attr({title:t.greeting_title,"data-url":t.greeting_url||""}).find(".opinions").slice(1).remove(),document.title=t.greeting+" - "+_h("A-title")+" | \uD83D\uDC9D Hearty Journal 溫度日記",i.find(".comment [data-greeting_id]").attr("data-greeting_id",e),t.comments.length>0&&a.find(".opinions:first").after(t.comments.map(function(e){return alice_greeting_comments(t,e)})),$(".directory_inner [data-greeting_id]").removeAttr("data-active").filter("[data-greeting_id='"+e+"']").attr("data-active","");let o=$(".profile .profile_btns");31==e?(o.show(),alice_update({action:"signup_days"}).then(function(e){let t=parseInt(e.Values.signup_days||0);1==e.Status&&t<6&&(msg('<i class="far fa-user-check"></i> '+_h("A-penpal_guest-0",{$day:numberWithCommas(++t),$th:nth(t)}),_h("A-penpal_guest-1")+' <i class="fas fa-fist-raised"></i>',function(){alice_greeting_read()}),ga_evt_push("Penpal_not_allowed"))})):o.hide(),$("body").width()>=768&&alice_opinions_toggle(!0),"function"==typeof history.replaceState&&history.replaceState({},t.greeting_title,"/home?g="+e)}})}function alice_greeting_comments(e,t){let i=t.gender,n=t.profile_image||"default"+(1==i?"_male":"")+".jpg";return $("<li>",{class:"opinions",html:$("<div>",{class:"avatar",title:t.nickname,onclick:"profile_popup('"+t.username+"','"+t.nickname+"','"+n+"','"+i+"')","data-vip":t.is_vip}).css({"background-image":"url(//i.hearty.app/u/"+n+")"}).add($("<div>",{class:"opinion",title:t.comment,"data-user":t.nickname}).text(htmlDecode(t.comment)).append($("<a>",{onclick:"alice_comment_toggle(this.dataset,$(this).parent())","data-greeting_id":e.greeting_id,"data-comment_id":t.comment_id,"data-comment_own":t.comment_own})))})}function alice_greeting_comment(e){let t=$(".goodnight [data-opinions]"),i=t.find(".comment textarea"),n=(i.val()||"").trim().replace(/[\r\n]{2,}/g,"\n");if(t.find("[data-comment_own='1']").length>1)msg('<i class="fal fa-comment-lines"></i> '+_h("A-comment_limit-0")),shake(i);else if(n.length>85)msg('<i class="fal fa-comment-lines"></i> '+_h("A-comment_limit-1",{$chars:n.length})),shake(i);else if(n.length>2){if(i.val("").css({height:"auto"}),banned_words(n))return report_abuse("已拒登",e,"",n),msg('<i class="fal fa-info-circle"></i> '+_h("A-comment_ban-0")+"<br>"+_h("A-comment_ban-1")+'<br><i class="fal fa-sticky-note"></i> '+_h("A-comment_ban-2")+" <a target='_blank' href='//faq.hearty.me/tutorial/public_diaries'>["+_h("A-comment_ban-3")+"]</a>"),!1;alice_update({action:"comment",greeting_id:e,comment:n}).then(function(a){switch(a.Status){case 1:let o=(a=a.Values).gender,l=a.profile_image||"default"+(1==o?"_male":"")+".jpg";t.scrollTop(0).find(".opinions:first").after(alice_greeting_comments({greeting_id:e},{username:a.username,nickname:a.nickname,profile_image:l,gender:o,comment_id:a.comment_id,comment_own:1,comment:n})),ga_evt_push("Comment",{event_category:"Posts",event_label:"Comment"}),fb_evt_push("Comment");break;case 2:i.val(n),alice_signin_required()}}).fail(function(){i.val(n),shake(i)})}else msg('<i class="fal fa-comment-lines"></i> '+_h("A-comment_limit-2")),shake(i)}function hj_share_page(){let e=$(".alice_inner [data-opinions] ul").attr("data-url")||"";e?e="https://hj.rs/"+e:(e=location.href.replace(location.host,"hearty.app"),e+=(e.indexOf("?")>0?"&":"?")+"st=Alice%20%E8%AA%AA%E6%99%9A%E5%AE%89"),/iOS|Android/i.test(check_hjapp())?location.assign("//hearty.me/wv?s="+encodeURIComponent(e.replace(/(^\w+:|^)\/\//,""))):is_touch_device()&&"share"in navigator?navigator.share({title:document.title,url:e}).catch(function(e){}):(alertify.set({labels:{ok:_h("A-url-2")+' <i class="fas fa-qrcode"></i>',cancel:'<i class="fas fa-copy"></i> '+_h("A-url-0")},buttonReverse:!0}),alertify.prompt('<i class="fal fa-link"></i> '+_h("A-url-1")+'<br><br><a class="qrcode"></a>',function(e){e?$("#alertify .qrcode").get(0).click():hj_copy($("#alertify .alertify-text"))},e),alertify_input_custom({type:"url",inputmode:"none",placeholder:e,onclick:"hj_copy($(this))"},{cursor:"copy"}),hj_copy_text(e),get_qrcode($("#alertify .qrcode"),e))}function alice_comment_toggle(e,t){let i=Number(e.greeting_id),n=Number(e.comment_id);"1"==e.comment_own?(alertify.set({labels:{ok:_h("A-no"),cancel:'<i class="fas fa-pencil"></i> '+_h("A-comment_edit-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-edit"></i> '+_h("A-comment_edit-0"),function(e){e||alice_update({action:"comment_delete",comment_id:n}).then(function(e){switch(e.Status){case 1:let i=$(".comment textarea");i.val((t.text()+" "+(i.val()||"")).trim()).focus(),t.parent().slideUp(400,function(){$(this).remove()}),hj_vibrate(30),ga_evt_push("Comment Removed",{event_category:"Posts",event_label:"Comment Removed"}),fb_evt_push("Comment Removed");break;case 2:alice_signin_required()}})})):account_status().then(function(e){1==e.Status?(alertify.set({labels:{ok:_h("A-no"),cancel:'<i class="fas fa-check-circle"></i> '+_h("A-report_ask-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-flag-alt"></i> '+_h("A-report_ask-0"),function(e){e||(t.parent().css({opacity:.5}),msg("\uD83D\uDCDD "+_h("A-report_ask-2")),report_abuse("被檢舉",i,n,t.text()),ga_evt_push("Comment Reported",{event_category:"Posts",event_label:"Comment Reported"}),fb_evt_push("Comment Reported"))})):msg('<i class="fal fa-door-open"></i>'+_h("A-signin-2"))})}function report_abuse(e,t,i,n){gform_post("1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",{"entry.783049182":getcookie("hearty_u"),"entry.866865386":getcookie("hearty_id"),emailAddress:getcookie("hearty_em"),"entry.527303026":"說晚安留言 ("+(e||"")+")","entry.355700800":t||"","entry.1270264487":i||"","entry.1592095357":(n||"").trim(),"entry.1259076046":today(8),"entry.124585191":check_browser()+", "+check_OS()})}function alice_signin_required(){hj_update({action:"account_status"}).then(function(e){1===e.Status&&location.reload(!0)}),alice_signin_ask()}function alice_signin_ask(e){let t="?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+"#signin";e?hj_href(t):(alertify.set({labels:{ok:'<i class="fas fa-door-open"></i> '+_h("A-signin-0"),cancel:_h("A-no")}}),alertify.confirm('<i class="fal fa-user-lock"></i> '+_h("A-signin-1"),function(e){e&&hj_href(t)}))}function profile_popup(e,t,i,n){let a=$(".goodnight .profile");null==e?a.fadeOut("fast"):(a.find(".avatar").css({"background-image":"url(//i.hearty.app/u/"+i+")"}),a.find("[data-n]").attr({title:t,"data-gender":n}),a.find("[data-link]").attr({"data-username":e,"data-nickname":t}),a.find("[data-penpal_add]").attr({"data-username":e}),a.fadeIn("fast"))}function penpal_waitlist(){if(user_verify())try{check_hjapp("Android")?penpal_waitlist_redirect():($(".mask").show(),hj_fcm_init(penpal_waitlist_redirect))}catch(e){penpal_waitlist_redirect()}else user_verify(!0)}function penpal_waitlist_redirect(){$(".mask").hide(),alice_greeting_read(31),alice_opinions_toggle()}function penpal_add(e){alertify.set({labels:{ok:'<i class="fas fa-paw-claws"></i> '+_h("A-penpal_add-2"),cancel:_h("A-no")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-user-edit"></i> '+_h("A-penpal_add-0",{$id:e})+'<br><i class="fal fa-info-circle"></i> '+_h("A-penpal_add-1"),function(t){t&&hj_href("d?penpal_add="+e)})}function account_prefilling(){let e=getUrlPara("a");e&&!getcookie("hearty_account")&&setcookie("hearty_account",e,90)}function banned_words(e){return/http|www.|死|自(殘|残|殺|杀)|白(癡|痴|目)|北七|智障|腦殘|脑残|婊子|三小|(機|机)掰|大便|屎|屌|賤|贱|他(媽|妈)的|e04|(幹|干)你|你娘|拎老|靠北|夭(壽|寿)|外(送茶|約)|(約|正)妹|加賴|(性|做|愛)愛|(打|約)(炮|砲)|(全|半|無|戴)套|口(交|爆)|(內|顏|颜)射|(性|援|肛)交|一夜情|女優|(叫|找)小姐|(春|壯陽)(藥|药)|持久液|早洩|陽痿|(娛樂|娱乐)城|博奕|賭場|赌场|中((華|华)(人|)民(共和|)|)(國|国|共)|政府|(執|执)政|共(產|产)|黨|党|海(峽|峡)|(兩|两)岸|(習|习)近平|李(|克)(強|强)|郭文(貴|贵)|閆麗夢|闫丽梦|(希|西)塔|阿卡(西|夏)|大(師|师)|(師|师)(傅|父)|薩滿|萨满|頌缽|颂钵|通(靈|灵)|(靈|灵)(性|魂|體|体|數|数|命|氣|气)|梵|(顯|显)化|磁(場|场)|命(理|盤|盘)|脈輪|脉轮|(覺|觉)醒|魔法|算命|八字|紫薇|斗數|卜卦|(風|风)水|易(經|经|卦)|星(盤|盘)|(瑪|玛)雅曆|佛|南(無|无)|菩(提|薩|萨)|如(來|来)|(觀|观)音|修(行|士)|法(門|门)|妙法|大悲|(業|业)(障|力)|淨土|慧炬|心語|萊豬|莱猪|\s+(fuck|shit|bitch|asshole|dick)|\s+(fuck|shit|bitch|asshole|dick)/i.test(e||"")}$(function(){post_font(),hj_localize_cn(),hj_alice_history_init(),account_prefilling();let e={top:$(".directory .nav_btn[data-top]"),left:$(".directory .nav_btn[data-left]")};e.top.hide(),$(".directory").scroll(function(){$(this).scrollTop()>200?e.left.stop().fadeOut("fast",function(){e.top.stop().fadeIn()}):e.top.stop().fadeOut("slow",function(){e.left.stop().fadeIn()})}),$(".mh-head .left").on("click",function(){nav_toggle($(".menu"),!0)}),$(".alice").find(".tabs,[data-opinions] ul").on("click",function(e){e.stopPropagation()});let t=$(".profile");t.on("click",function(){profile_popup()}).find(".avatar").on("click",function(){t.find("[data-link]:visible").click()}),t.find(".profile_btns").on("click",function(e){e.stopPropagation()}).find("[data-link]").on("click",function(){open_url(location.origin+"/"+this.dataset.username+"?feed=1")}),t.find("[data-penpal_add]").on("click",function(){penpal_add(this.dataset.username)});let i=$(".alice_inner textarea").on("input",function(){let e=$(this),t=$(".alice_inner .comment");e.val().length>=85?t.addClass("invalid"):t.removeClass("invalid")}).autogrow();user_verify()||i.on("click",function(){user_verify(!0)}).attr({readonly:""})}),leave_InAppBrowser();