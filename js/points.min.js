"use strict";function pt_balance(){hj_update({action:"hearty_points",query:"balance_lookup"}).then(function(t){let e=$("[data-points]");switch(t.Status){case 1:e.text(numberWithCommas(parseInt(t.Values.points)));break;case 2:e.empty(),$(".get_coupons").remove()}})}function pt_get(){alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("pt-get-2"),cancel:_h("pt-no")}}),alertify.confirm('<i class="fal fa-bell"></i> '+_h("pt-get-1"),function(t){t&&hj_href("d")})}function pt_coupons(){hj_loading(!0),pt_update({action:"get_coupons"}).then(function(t){switch(t.Status){case 1:if((t=t.Values).length>0){let e=$(".coupons tbody");e.empty(),$.each(t,function(t,a){let i=a.code,n=$("<td>");"POINT"==i.slice(0,5)?n.attr("data-used",_h("pt-coupons-6")):n.text(i).attr("data-cp",""),$("<tr>").append($("<td>",{text:_h("pt-pkg_"+a.pkg+"-0")}),n,$("<td>",{text:a.created}),$("<td>",{text:a.exp})).appendTo(e)})}pt_pop(!0,"coupons");break;case 2:pt_signin_ask();break;default:msg()}}).fail(function(t){msg()}).always(function(){hj_loading(!1)})}function pt_pop(t,e){let a=$("body"),i=$(".popup");t?(i.children("."+e).add(i.removeAttr("data-hidden")).fadeIn(),a.addClass("noscroll")):(i.children("div").add(i).fadeOut(),a.removeClass("noscroll"))}function pt_update(t){return $.ajax({url:location.href,type:"POST",dataType:"json",data:t,async:!0,timeout:1e4})}function pt_signin_ask(){alertify.set({labels:{ok:'<i class="fas fa-door-open"></i> '+_h("pt-signin-0"),cancel:_h("pt-no")}}),alertify.confirm('<i class="fal fa-user-lock"></i> '+_h("pt-signin-1"),function(t){t&&hj_href("?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+"#signin")})}function pt_redeem(t,e){alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("pt-ok"),cancel:_h("pt-back")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-shopping-bag"></i> '+_h("pt-redeem-0",{$pkg:$(".pkg:visible h3").text(),$p:e})+"<br>"+_h("pt-redeem-1")+" ♡",function(e){if(e){if($("header [data-points]:hidden").length>0){pt_signin_ask();return}let a=$('input[type="checkbox"]:visible');if(a.length>0&&!a.is(":checked")){msg('<i class="fal fa-check-circle"></i> '+_h("pt-agree")),a.focus().get(0).scrollIntoViewIfNeeded(),shake(a);return}switch(t){case"vip14":pt_vip("vip14",14);break;case"vip30":pt_vip("vip30",30);break;case"ec100":pt_ec("ec100",100);break;default:msg()}}})}function pt_ec(t,e){hj_loading(!0),pt_update({action:"redeem",pkg:t,amt:e}).then(function(t){switch(t.Status){case 1:let a=(t=t.Values||[]).code||"";hj_copy_text(a),alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("pt-use-0"),cancel:_h("pt-close")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-check-circle"></i> '+_h("pt-ec_ok-0",{$amt:e,$code:a})+"<br>"+_h("pt-ec_ok-1",{$exp:new Date(t.exp||"").toLocaleDateString()}),function(t){hj_copy_text(a),t&&window.open("/life","_blank")},a),alertify_input_custom({inputmode:"none",placeholder:a,onclick:"hj_copy($(this))"},{cursor:"copy"}),pt_pop(!1),pt_balance(),pt_coupons();break;case 2:pt_signin_ask();break;case 3:msg('<i class="fal fa-info-circle"></i> '+_h("pt-redeem-2",{$pkg:$(".pkg:visible h3").text()}));break;case 4:msg('<i class="fal fa-info-circle"></i> '+_h("pt-redeem-3"));break;default:msg(t.Values.err||"")}}).fail(function(t){msg(JSON.stringify(t))}).always(function(){hj_loading(!1)})}function pt_vip(t,e){hj_loading(!0),pt_update({action:"redeem",pkg:t,dur:e}).then(function(t){switch(t.Status){case 1:let e=t.Values.voucher||"";console.log("* 溫度日記 VIP兌換序號："+e),$.ajax({url:"/gift/"+e,type:"POST",dataType:"json",data:{voucher:e},async:!0}).then(function(t){1==t.Status?(t=t.Values||[],alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("pt-vip_ok-1"),cancel:_h("pt-close")}}),alertify.confirm('<i class="far fa-gift"></i> '+_h("pt-vip_ok-0",{$days:t.dur||0,$exp:new Date(t.exp||"").toLocaleDateString()})+' <i class="far fa-check-circle"></i>',function(t){t&&hj_href("account?tab=1")}),pt_pop(!1),pt_balance()):msg(t.Values.err||"")}).fail(function(){msg()}).always(function(){hj_loading(!1)});break;case 2:pt_signin_ask();break;case 3:msg('<i class="fal fa-info-circle"></i> '+_h("pt-redeem-1",{$pkg:$(".pkg:visible h3").text()}));break;case 4:msg('<i class="fal fa-info-circle"></i> '+_h("pt-redeem-2"));break;default:msg(t.Values.err||"")}}).fail(function(t){msg(JSON.stringify(t))}).always(function(){hj_loading(!1)})}$(function(){pt_balance(),$(".popup>div").on("click",function(t){t.stopPropagation()}),$(".coupons").on("click","[data-cp]",function(){$(this).text().length>0&&hj_copy($(this))});let t=_h$.lang;"en-us"==t&&$(".pkgs [data-pkg^='ec']").remove(),$(".popup>.pkg").each(function(){"zh-cn"==t&&(t="zh-tw"),$(this).is('[data-lang="'+t+'"]')||$(this).remove()}),document.title=_h("pt-title")+" ♥ Hearty Journal 溫度日記"});