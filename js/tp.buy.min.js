"use strict";window.jQuery||alert("Please disable Adblock & clean caches.\n請停用 Adblock及清除快取")||window.open("//bit.ly/3I7cEJz","_blank");var _h$={tp:[{back:"Back",title:"TapPay Payment | Hearty Journal 溫度日記",prd:"Hearty Journal",item:"Item",plan:"Plan",amt:"Amount",ask:"Encountering payment issues?",card:["Credit Card Payment","Credit Card Subscription"],phone:["Country (A-Z)","Mobile number, Card Holder"],types:"VISA, MasterCard, JCB & Union Pay",pay:"Checkout",agree:["I hereby authorize and permit to sign the power of attorney to execute the credit card payment by Hearty Journal.","You must authorize the credit card payment to purchase the subscription plan."],mpay:"Or use mobile payment",alipay:"Alipay",footer:"This site uses TapPay SSL 2048-bit payment system. Your payment is securely processed by the bank and we never handle your credit card information. TapPay is PCI-DSS compliant, ensuring the safety of your data.",ok:"OK",no:"Cancel",kyc:["To comply with financial regulator's anti-fraud rules in Taiwan, please provide the phone number on file with your card-issuing bank for ID verification.","The phone number $no doesn't match the bank's records. Please provide the correct number and try again. Thank you."],done:["Payment completed. Thank you for upgrading to the VIP plan of Hearty Journal.","Order No. $no"],fail:["Transaction failed. Please check the card number or use a different payment method. If the issue persists, please contact support.","Transaction failed. Please check the card number or use a different card. If the issue persists, please contact support.","Order No. $no","Contact us"],err:["Sorry, an unexpected error occurred."]},{back:"回前頁",title:"TapPay付款 | 溫度日記 Hearty Journal",prd:"溫度日記 Hearty Journal",item:"方案",plan:"內容",amt:"金額",ask:"遇到刷卡問題？",card:["信用卡付款","信用卡訂閱"],phone:["國碼 (A-Z)","持卡人手機號碼"],types:"VISA、MasterCard、JCB、銀聯卡",pay:"結帳",agree:["我同意自下次交易起由溫度日記向 TapPay發動信用卡授權指示","您需同意信用卡授權，才能購買訂閱方案"],mpay:"或使用行動支付",alipay:"支付寶",footer:"本站採⽤喬睿科技(TapPay) SSL 2048-bit 交易系統。刷卡時，將於銀⾏端完成交易，本站絕不會經手您的信⽤卡資料。TapPay系統亦通過 PCI-DSS安全稽核，保障您的資料安全無虞。",ok:"好的",no:"取消",kyc:["為遵守台灣金管會的防詐新制，請您提供您在發卡銀行留存的手機號碼，以便進行交易簡訊認證。","您提供的手機號碼 $no 與銀行留存的不符。請提供正確的號碼並再試一次。"],done:["付款完成，謝謝您購買溫度日記 VIP","訂單編號：$no"],fail:["交易失敗，請確認輸入資料無誤，或更換信用卡，或另選付款方式，如問題持續請聯繫客服","刷卡失敗，請確認輸入資料無誤，或更換信用卡，如問題持續請聯繫客服","訂單編號：$no","聯繫客服"],err:["不好意思，似乎出錯了"]},{back:"回前页",title:"TapPay支付 | 温度日记 Hearty Journal",prd:"温度日记 Hearty Journal",item:"方案",plan:"内容",amt:"金额",ask:"遇到刷卡问题？",card:["银行卡付款","银行卡订阅"],phone:["国码 (A-Z)","持卡人手机号"],types:"VISA、MasterCard、JCB、银联卡",pay:"结帐",agree:["我同意自下次交易起由温度日记向 TapPay发动银行卡授权指示","您需同意银行卡授权，才能购买订阅方案"],mpay:"或使用移动支付",alipay:"支付宝",footer:"本站採⽤乔睿科技(TapPay) SSL 2048-bit 交易系统。刷卡时，将于银⾏端完成交易，本站绝不会经手您的银行卡数据。TapPay系统亦通过 PCI-DSS安全稽核，保障您的数据安全无虞。",ok:"好的",no:"取消",kyc:["为遵守台湾金管会的防诈新制，请您提供您在发卡银行留存的手机号码，以便进行交易简讯认证。","您提供的手机号 $no 与银行留存的不符。请提供正确的号码并再试一次。"],fail:["交易失败，请确认输入数据无误，或更换银行卡，或另选支付方式，如问题持续请联繫客服","刷卡失败，请确认输入数据无误，或更换银行卡，如问题持续请联繫客服","订单编号：$no","联繫客服"],err:["抱歉，似乎出错了"]}][tp_lang()]};function tp_params(t){let e=$("body");if(t)return $.param(e.get(0).dataset);{if(!(location.search||"").length){top.location.href="//bitly.com/3fmoEYD";return}let a=getUrlPara("3ds");e.attr({"data-pkg":getUrlPara("pkg"),"data-3ds":a,"data-recurring":getUrlPara("recurring"),"data-ip":getUrlPara("ip"),"data-cc":getUrlPara("cc")}),tp_isapp()||"function"!=typeof history.replaceState||history.replaceState(null,"",location.pathname)}}function tp_init(){let t=0==$("body").attr("data-prod"),e=$(".demo");TPDirect.setupSDK(146938,"app_tqcNPY9hA34zrTxrpSiJ263QjhRojqktIxruWM47YobDh83m7E1GKlf3XPN4",t?"sandbox":"production"),t?e.removeClass("hidden").on("click",function(){window.open("//docs.tappaysdk.com/tutorial/zh/reference.html#test-card","_blank")}).find("a").on("click",function(t){t.stopPropagation(),navigator.clipboard.writeText($(this).text())}):e.remove()}function tp_dpay_btn(t){return tp_loading(!t),$("#dpay_btn").prop({disabled:!t})}function tp_init_dpay(){try{TPDirect.card.setup("#dpay",{color:"rgb(0,0,0)",fontSize:"15px",lineHeight:"24px",fontWeight:"300",errorColor:"red",placeholderColor:""},{isUsedCcv:!1,isMaskCreditCardNumber:!0,maskCreditCardNumberRange:{beginIndex:6,endIndex:11}});let t=$("#phone_cc");if(t.length>0&&!t.val()){let e=dial_code(getUrlPara("cc")||"");t.val(e).find("[value="+e+"]").attr({selected:"selected"})}let a=$("#dpay_btn").on("click",function(t){t.preventDefault(),tp_dpay_btn(!1),TPDirect.card.getPrime(function(t){let e=t.card;tp_pay(1,e.prime||"",e.countrycode||"")})});TPDirect.card.onUpdate(function(t){a.prop({disabled:!t.canGetPrime})}),$("#agree").on("click",function(t){t.preventDefault(),tp_msg('<i class="fal fa-badge-check"></i> '+_h("tp-agree-1"))})}catch(r){console.error("Dpay Error")}}function dial_code(t){t=(t||"").toUpperCase();let e={AD:376,AE:971,AF:93,AG:1,AI:1,AL:355,AM:374,AO:244,AQ:672,AR:54,AS:1,AT:43,AU:61,AW:297,AX:358,AZ:994,BA:387,BB:1,BD:880,BE:32,BF:226,BG:359,BH:973,BI:257,BJ:229,BL:590,BM:1,BN:673,BO:591,BQ:599,BR:55,BS:1,BT:975,BV:47,BW:267,BY:375,BZ:501,CA:1,CC:61,CD:243,CF:236,CG:242,CH:41,CI:225,CK:682,CL:56,CM:237,CN:86,CO:57,CR:506,CU:53,CV:238,CW:599,CX:61,CY:357,CZ:420,DE:49,DJ:253,DK:45,DM:1,DO:1,DZ:213,EC:593,EE:372,EG:20,EH:212,ER:291,ES:34,ET:251,FI:358,FJ:679,FK:500,FM:691,FO:298,FR:33,GA:241,GB:44,GD:1,GE:995,GF:594,GG:44,GH:233,GI:350,GL:299,GM:220,GN:224,GP:590,GQ:240,GR:30,GS:500,GT:502,GU:1,GW:245,GY:592,HK:852,HM:672,HN:504,HR:385,HT:509,HU:36,ID:62,IE:353,IL:972,IM:44,IN:91,IO:246,IQ:964,IR:98,IS:354,IT:39,JE:44,JM:1,JO:962,JP:81,KE:254,KG:996,KH:855,KI:686,KM:269,KN:1,KP:850,KR:82,KW:965,KY:1,KZ:7,LA:856,LB:961,LC:1,LI:423,LK:94,LR:231,LS:266,LT:370,LU:352,LV:371,LY:218,MA:212,MC:377,MD:373,ME:382,MF:590,MG:261,MH:692,MK:389,ML:223,MM:95,MN:976,MO:853,MP:1,MQ:596,MR:222,MS:1,MT:356,MU:230,MV:960,MW:265,MX:52,MY:60,MZ:258,NA:264,NC:687,NE:227,NF:672,NG:234,NI:505,NL:31,NO:47,NP:977,NR:674,NU:683,NZ:64,OM:968,PA:507,PE:51,PF:689,PG:675,PH:63,PK:92,PL:48,PM:508,PN:870,PR:1,PS:970,PT:351,PW:680,PY:595,QA:974,RE:262,RO:40,RS:381,RU:7,RW:250,SA:966,SB:677,SC:248,SD:249,SE:46,SG:65,SH:290,SI:386,SJ:47,SK:421,SL:232,SM:378,SN:221,SO:252,SR:597,SS:211,ST:239,SV:503,SX:1,SY:963,SZ:268,TC:1,TD:235,TF:262,TG:228,TH:66,TJ:992,TK:690,TL:670,TM:993,TN:216,TO:676,TR:90,TT:1,TV:688,TW:886,TZ:255,UA:380,UG:256,UM:246,US:1,UY:598,UZ:998,VA:379,VC:1,VE:58,VG:1,VI:1,VN:84,VU:678,WF:681,WS:685,YE:967,YT:262,ZA:27,ZM:260,ZW:263};return t in e?e[t]:886}function tp_init_apay(){try{let t=$("#apay");TPDirect.paymentRequestApi.checkAvailability()&&(TPDirect.paymentRequestApi.setupApplePay({merchantIdentifier:"merchant.hearty.tappay"}),TPDirect.paymentRequestApi.setupPaymentRequest({supportedNetworks:["VISA","MASTERCARD","JCB"],supportedMethods:["apple_pay"],displayItems:[{label:$("#item").text(),amount:{currency:"TWD",value:"1"}}],total:{label:_h("tp-prd"),amount:{currency:"TWD",value:parseInt($("#amt").text())}}},function(e){window.ApplePaySession&&e.canMakePaymentWithActiveCard?t.on("click",function(){TPDirect.paymentRequestApi.getPrime(function(t){tp_pay(8,t.prime||"")})}).show():t.remove()}))}catch(e){$ap.remove(),console.error("Apay Error")}}function tp_init_gpay(){let t=$("#gpay");try{TPDirect.googlePay.setupGooglePay({googleMerchantId:"BCR2DN4TRGFNNFJ3",tappayGoogleMerchantId:"hearty_TAISHIN",allowedCardAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],merchantName:"Hearty Creative Inc.",allowPrepaidCards:!0}),TPDirect.googlePay.setupPaymentRequest({allowedNetworks:["VISA","MASTERCARD","JCB"],price:parseInt($("#amt").text()).toString(),currency:"TWD"},function(e,a){a.canUseGooglePay?TPDirect.googlePay.setupGooglePayButton({el:"#gpay",color:"white",type:"short",getPrimeCallback:function(t,e){tp_pay(9,e||"")}}):t.remove()})}catch(e){t.remove(),console.error("Gpay Error")}}function tp_pay(t,e,a){if(e.length>0){let r={payvia:t,prime:e};if(1==t){r.card_country=a||"";let n=$("#phone_no");if(n.length>0){let o=$("#phone_cc").val()||"",i=n.val()||"";if(o&&i.length>3)886==o&&(i=i.replace(/^0(?=9)/,"")),r.phone="+"+o+i;else{tp_kyc(),tp_dpay_btn(!0);return}}}console.log("* fn tp_pay: "+JSON.stringify(r)),$.ajax({type:"post",url:location.origin+"/shop/tp.prime?"+tp_params(!0),async:!0,crossDomain:!0,dataType:"json",data:r,timeout:15e3}).then(function(e){let a=e.Values||"";switch(e.Status||""){case 0:tp_pay_err("0","#"+(a.orderno||"*"));break;case 1:let r=a.orderno||"";fetch("//docs.google.com/forms/d/e/1FAIpQLSeooQCNhp2ubbIvshtucFLF5PVOE_ZRaHFAgBPvrVT_MDl_bg/formResponse",{method:"POST",mode:"no-cors",body:new URLSearchParams({"entry.553484449":$("[data-hid]").text()||"","entry.729548178":r,"entry.147291994":[,"dp",,,,,,,"ap","gp"][t]||"","entry.20989936":"url_3ds"in a?"Y":"N","entry.792614445":navigator.userAgent||"","entry.2000689905":new Date((new Date).getTime()+288e5).toISOString().split("T")[0]})}),"url_3ds"in a?top.location.href=a.url_3ds:(tp_msg('<i class="fal fa-check-circle"></i> '+_h("tp-done-0")+'<br><i class="fal fa-file"></i> '+_h("tp-done-1",{$no:r||"*"})),top.location.href=location.origin+"/shop/tp.thankyou?o="+r);break;case 2:tp_pay_report(2,JSON.stringify(a||""));let n=$("body"),o=1==n.attr("data-recurring");alertify.set({labels:{ok:'<i class="fas fa-question-circle"></i> '+_h("tp-fail-3"),cancel:_h("tp-no")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-comment-alt-times"></i> '+_h("tp-fail-"+(o?1:0))+' (❁\xb4ㅁ`)ﾉ<br><i class="fal fa-file"></i> '+_h("tp-fail-2",{$no:a.orderno||"*"}),function(t){t&&tp_support()}),o||n.attr("data-3ds",0),tp_dpay_btn(!0);break;case 4:tp_pay_report(4,JSON.stringify(a||"")),tp_kyc("+"+($("#phone_cc").val()||"")+($("#phone_no").val()||"")),tp_dpay_btn(!0);break;case 3:tp_pay_err(3,a.err||"");break;default:tp_pay_err("D",JSON.stringify(e||""))}}).fail(function(t){tp_pay_err("F",JSON.stringify(t||""))})}}function tp_pay_err(t,e){tp_pay_report(t=t||"",e=e||""),tp_msg('<i class="far fa-sad-tear"></i> ['+t+"] "+_h("tp-err")+"<br>"+e),tp_dpay_btn(!0)}function tp_pay_report(t,e){fetch("//docs.google.com/forms/d/e/1FAIpQLSe15z1D2VmTe7W_F4uRjth7xSRT8rNUxyKG9qrcVRVRXM9nMA/formResponse",{method:"POST",mode:"no-cors",body:new URLSearchParams({"entry.553484449":$("[data-hid]").text()||"","entry.729548178":t,"entry.20989936":e,"entry.792614445":navigator.userAgent||"","entry.2000689905":new Date((new Date).getTime()+288e5).toISOString().split("T")[0]})})}function np_init_alipay(){$("#alipay").on("click",function(){tp_loading(!0),top.location.href=location.origin+"/shop/np.buy?alipay=1&"+tp_params(!0)}).show()}function TWD2local(t){return $.ajax({url:"//api.hearty.app/currency/TWD",type:"GET",crossDomain:!0,dataType:"json",async:!0,timeout:5e3}).then(function(e){return parseFloat(e.conversion_rates[t]||e.conversion_rates.USD)||0})}function getUrlPara(t){let e=RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=location.search.substr(1).match(e);return null!=a?decodeURIComponent(a[2]):null}function getcookie(t){for(var e=t+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){var n=a[r].trim();if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""}function tp_msg(t,e){alertify.set({labels:{ok:'<i class="fas fa-check"></i> '+_h("tp-ok")}}),alertify.alert(t||"",e||function(){})}function tp_loading(t){var e=$("body");!1===t?e.removeClass("loading"):e.addClass("loading").delay(1e4).queue(function(){$(this).removeClass("loading").dequeue()})}function tp_back(){tp_loading(!0),top.location.href="//bitly.com/3fmoEYD"}function tp_support(){window.open("//hearty.me/d?f=2","_blank")}function tp_kyc(t){let e=$("#phone_no");t?tp_msg('<i class="far fa-info-circle"></i> '+_h("tp-kyc-1",{$no:t||""}),function(){e.val("").focus()}):tp_msg('<i class="far fa-mobile"></i> '+_h("tp-kyc-0"),function(){e.focus()})}function tp_lang(){let t=[0,navigator.language||""];return/zh-cn/i.test(t[1])?t[0]=2:/zh/i.test(t[1])&&(t[0]=1),t[0]}function _h_init(){"object"==typeof _h$&&$("[data-h]").length>0&&$("body *,title").each(function(){let t=Object.assign({},$(this).get(0).dataset);for(let e in t)if("h"==e){let a=_h(t[e]).replace(/\n/g,"");$(this).is("title")?$(this).text(a):$(this).prepend(_h(t[e]).replace(/\n/g,"<br>")).attr({title:a}),$(this).removeAttr("data-h")}else if("h_date"==e){let r=t[e];r=r?date_format(t[e],!0):"",$(this).attr({"data-date":r,title:r}).removeAttr("data-"+e)}else if(e.startsWith("h_")){let n=_h(t[e]),o={};"title"==(e=e.substr(2))&&($(this).is("input,textarea,[contenteditable]")?o.placeholder=n:$(this).is("img")&&(o.alt=n)),o[0>["title","href","src","download"].indexOf(e)?"data-"+e:e]=n,$(this).attr(o).removeAttr("data-h_"+e)}})}function _h(t,e){if(t=(t||"").toString().split("-"),!window._h$||!(t.length>1)||!(t[0]in _h$)||!(t[1]in _h$[t[0]]))return t[0]&&(t="("+t.join("-")+")",console.warn("_h$"+t+" is missing")),t;{let a=_h$[t[0]][t[1]][t[2]];if(null==a&&(a=_h$[t[0]][t[1]]||""),"object"==typeof e)for(let r in e)a=a.replace(r,e[r]);return a}}function tp_isapp(t){let e=(navigator.userAgent||"").match(/Hearty_(iOS|Android|macOS)/)||[];return e=e.length>0&&e[0].replace(/Hearty_/i,""),null==t?e:t==e}$(function(){tp_init(),tp_init_dpay(),0==getUrlPara("recurring")?(tp_isapp()||tp_init_gpay(),tp_init_apay(),np_init_alipay(),$(".mobile").add($("#agree").parent()).remove()):($(".mobile_pay").remove(),$("h4").attr("data-h","tp-card-1"));let t=getUrlPara("cur");t&&TWD2local(t).then(function(e){let a=t+" "+Math.ceil((parseInt($("#amt").text())||0)*e*10)/10;$("[data-cur]").text(a).attr({title:a})}),_h_init(),tp_params(!1),$(".tp_logo").on("click",function(){alertify.alert('<i class="fal fa-shield-check"></i> '+_h("tp-footer"))})});